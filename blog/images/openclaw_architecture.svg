<?xml version="1.0" encoding="UTF-8"?>
<svg width="1400" height="900" xmlns="http://www.w3.org/2000/svg">
    <defs>
        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#666666" />
        </marker>
        
        <linearGradient id="bgGrad" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#f8fafc;stop-opacity:1" />
<stop offset="100%" style="stop-color:#e2e8f0;stop-opacity:1" />
        </linearGradient>
        <marker id="arrow" markerWidth="12" markerHeight="8" refX="12" refY="4" orient="auto">
            <polygon points="0 0, 12 4, 0 8" fill="#64748b"/>
        </marker>
        <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
            <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.1"/>
        </filter>
        
    </defs>
<rect x="0" y="0" width="1400" height="900" fill="url(#bgGrad)" stroke="none" stroke-width="2" rx="0"/><text x="700" y="50" font-family="Arial, sans-serif" font-size="32" font-weight="bold" fill="#1e293b" text-anchor="middle">OpenClaw 비동기 분석 파이프라인</text><text x="700" y="85" font-family="Arial, sans-serif" font-size="18" font-weight="normal" fill="#64748b" text-anchor="middle">auto_trader → OpenClaw → callback → DB</text><rect x="50" y="140" width="350" height="700" rx="16" fill="#ffffff" stroke="#3b82f6" stroke-width="2" filter="url(#shadow)"/><text x="225" y="175" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#1e40af" text-anchor="middle">Auto Trader (FastAPI)</text><rect x="80" y="210" width="290" height="90" fill="#dbeafe" stroke="#3b82f6" stroke-width="2" rx="12"/><text x="225" y="245" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#1e40af" text-anchor="middle">OpenClawClient</text><text x="225" y="270" font-family="Arial, sans-serif" font-size="14" font-weight="normal" fill="#3b82f6" text-anchor="middle">request_analysis()</text><text x="225" y="290" font-family="Arial, sans-serif" font-size="12" font-weight="normal" fill="#64748b" text-anchor="middle">uuid4() → request_id 생성</text><rect x="80" y="330" width="290" height="80" fill="#e0e7ff" stroke="#6366f1" stroke-width="2" rx="12"/><text x="225" y="360" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#4338ca" text-anchor="middle">_build_openclaw_message()</text><text x="225" y="385" font-family="Arial, sans-serif" font-size="12" font-weight="normal" fill="#64748b" text-anchor="middle">프롬프트 + 콜백URL + 스키마</text><rect x="80" y="520" width="290" height="90" fill="#dcfce7" stroke="#22c55e" stroke-width="2" rx="12"/><text x="225" y="555" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#166534" text-anchor="middle">/api/v1/openclaw/callback</text><text x="225" y="580" font-family="Arial, sans-serif" font-size="12" font-weight="normal" fill="#64748b" text-anchor="middle">POST: 분석 결과 수신</text><rect x="80" y="640" width="290" height="80" fill="#fef3c7" stroke="#f59e0b" stroke-width="2" rx="12"/><text x="225" y="670" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#b45309" text-anchor="middle">StockAnalysisResult</text><text x="225" y="695" font-family="Arial, sans-serif" font-size="12" font-weight="normal" fill="#64748b" text-anchor="middle">PostgreSQL 영구 저장</text><rect x="80" y="750" width="290" height="60" fill="#fce7f3" stroke="#ec4899" stroke-width="2" rx="12"/><text x="225" y="780" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#be185d" text-anchor="middle">AuthMiddleware</text><text x="225" y="800" font-family="Arial, sans-serif" font-size="11" font-weight="normal" fill="#64748b" text-anchor="middle">/openclaw/callback allowlist</text><path d="M370 260 L490 260 L490 350 L580 350" fill="none" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrow)"/><text x="430" y="245" font-family="Arial, sans-serif" font-size="12" font-weight="normal" fill="#3b82f6" text-anchor="middle">① POST /hooks/agent</text><text x="430" y="320" font-family="Arial, sans-serif" font-size="11" font-weight="normal" fill="#64748b" text-anchor="middle">sessionKey:</text><text x="430" y="335" font-family="Arial, sans-serif" font-size="10" font-weight="normal" fill="#64748b" text-anchor="middle">auto-trader:openclaw:{id}</text><path d="M820 550 L490 550 L490 560 L370 560" fill="none" stroke="#22c55e" stroke-width="2" marker-end="url(#arrow)"/><text x="595" y="535" font-family="Arial, sans-serif" font-size="12" font-weight="normal" fill="#22c55e" text-anchor="middle">④ POST callback_url</text><text x="595" y="575" font-family="Arial, sans-serif" font-size="10" font-weight="normal" fill="#64748b" text-anchor="middle">Authorization: Bearer {token}</text><line x1="225" y1="610" x2="225" y2="630" stroke="#f59e0b" stroke-width="2" marker-end="url(#arrow)"/><text x="245" y="625" font-family="Arial, sans-serif" font-size="11" font-weight="normal" fill="#f59e0b" text-anchor="start">⑤ INSERT</text><rect x="580" y="140" width="380" height="480" rx="16" fill="#faf5ff" stroke="#9333ea" stroke-width="2" filter="url(#shadow)"/><text x="770" y="175" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#7c3aed" text-anchor="middle">OpenClaw (Raspberry Pi 5)</text><rect x="610" y="210" width="320" height="80" fill="#f3e8ff" stroke="#a855f7" stroke-width="2" rx="12"/><text x="770" y="245" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#7c3aed" text-anchor="middle">Gateway /hooks/agent</text><text x="770" y="270" font-family="Arial, sans-serif" font-size="12" font-weight="normal" fill="#64748b" text-anchor="middle">Bearer token 인증</text><line x1="770" y1="290" x2="770" y2="320" stroke="#a855f7" stroke-width="2" marker-end="url(#arrow)"/><text x="790" y="310" font-family="Arial, sans-serif" font-size="11" font-weight="normal" fill="#a855f7" text-anchor="start">② 큐잉</text><rect x="610" y="330" width="320" height="130" fill="#ede9fe" stroke="#8b5cf6" stroke-width="2" rx="12"/><text x="770" y="365" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#6d28d9" text-anchor="middle">Agent (Robin)</text><text x="770" y="395" font-family="Arial, sans-serif" font-size="14" font-weight="normal" fill="#7c3aed" text-anchor="middle">③ GPT/Claude 분석 실행</text><text x="770" y="425" font-family="Arial, sans-serif" font-size="12" font-weight="normal" fill="#64748b" text-anchor="middle">message 파싱 → LLM 호출</text><text x="770" y="445" font-family="Arial, sans-serif" font-size="12" font-weight="normal" fill="#64748b" text-anchor="middle">→ JSON 결과 생성</text><rect x="610" y="490" width="320" height="100" fill="#fef3c7" stroke="#f59e0b" stroke-width="2" rx="12"/><text x="770" y="525" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#b45309" text-anchor="middle">HTTP Callback 전송</text><text x="770" y="555" font-family="Arial, sans-serif" font-size="12" font-weight="normal" fill="#64748b" text-anchor="middle">callback_url + token</text><text x="770" y="575" font-family="Arial, sans-serif" font-size="11" font-weight="normal" fill="#64748b" text-anchor="middle">JSON: decision, confidence, ...</text><rect x="1000" y="700" width="350" height="150" fill="#ffffff" stroke="#cbd5e1" stroke-width="2" rx="12"/><text x="1175" y="730" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#334155" text-anchor="middle">상관관계 키</text><rect x="1020" y="750" width="140" height="35" fill="#dbeafe" stroke="#3b82f6" stroke-width="2" rx="6"/><text x="1090" y="773" font-family="Arial, sans-serif" font-size="12" font-weight="normal" fill="#1e40af" text-anchor="middle">request_id</text><rect x="1180" y="750" width="150" height="35" fill="#f3e8ff" stroke="#a855f7" stroke-width="2" rx="6"/><text x="1255" y="773" font-family="Arial, sans-serif" font-size="12" font-weight="normal" fill="#7c3aed" text-anchor="middle">sessionKey</text><text x="1175" y="820" font-family="Arial, sans-serif" font-size="12" font-weight="normal" fill="#64748b" text-anchor="middle">같은 UUID로 요청/응답 매칭</text></svg>