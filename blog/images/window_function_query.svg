<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800"><rect width="1200" height="800" fill="#0f172a"/><text x="600" y="50" fill="#fff" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="32" font-weight="bold" text-anchor="middle">Window Function으로 종목별 최신 분석 조회하기</text><text x="100" y="110" fill="#fbbf24" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="20" font-weight="bold">문제: 같은 종목에 대한 여러 분석 결과</text><g transform="translate(100, 130)"><rect width="1000" height="50" fill="#1e40af"/><text x="100" y="33" fill="#fff" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle">종목명</text><text x="300" y="33" fill="#fff" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle">분석 시간</text><text x="500" y="33" fill="#fff" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle">결정</text><text x="700" y="33" fill="#fff" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle">신뢰도</text><text x="900" y="33" fill="#fff" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle">적정 매수가</text><rect width="1000" height="45" y="50" fill="#1e293b"/><text x="100" y="78" fill="#cbd5e1" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="15" text-anchor="middle">삼성전자</text><text x="300" y="78" fill="#94a3b8" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="14" text-anchor="middle">2025-01-10 09:00</text><text x="500" y="78" fill="#fbbf24" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="15" text-anchor="middle">hold</text><text x="700" y="78" fill="#94a3b8" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="15" text-anchor="middle">75%</text><text x="900" y="78" fill="#94a3b8" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="15" text-anchor="middle">65,000~70,000</text><rect width="1000" height="45" y="95" fill="#065f46"/><text x="100" y="123" fill="#d1fae5" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="15" text-anchor="middle">삼성전자</text><text x="300" y="123" fill="#10b981" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle">2025-01-15 14:30</text><text x="500" y="123" fill="#10b981" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="15" font-weight="bold" text-anchor="middle">buy</text><text x="700" y="123" fill="#10b981" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="15" font-weight="bold" text-anchor="middle">82%</text><text x="900" y="123" fill="#10b981" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="15" font-weight="bold" text-anchor="middle">68,000~72,000</text><text x="1050" y="123" fill="#10b981" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="18">👈 최신</text><rect width="1000" height="45" y="140" fill="#1e293b"/><text x="100" y="168" fill="#cbd5e1" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="15" text-anchor="middle">AAPL</text><text x="300" y="168" fill="#94a3b8" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="14" text-anchor="middle">2025-01-12 10:00</text><text x="500" y="168" fill="#10b981" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="15" text-anchor="middle">buy</text><text x="700" y="168" fill="#94a3b8" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="15" text-anchor="middle">88%</text><text x="900" y="168" fill="#94a3b8" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="15" text-anchor="middle">180~185</text><rect width="1000" height="45" y="185" fill="#065f46"/><text x="100" y="213" fill="#d1fae5" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="15" text-anchor="middle">AAPL</text><text x="300" y="213" fill="#10b981" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle">2025-01-14 16:00</text><text x="500" y="213" fill="#10b981" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="15" font-weight="bold" text-anchor="middle">hold</text><text x="700" y="213" fill="#10b981" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="15" font-weight="bold" text-anchor="middle">70%</text><text x="900" y="213" fill="#10b981" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="15" font-weight="bold" text-anchor="middle">185~190</text><text x="1050" y="213" fill="#10b981" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="18">👈 최신</text><rect width="1000" height="45" y="230" fill="#1e293b"/><text x="100" y="258" fill="#cbd5e1" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="15" text-anchor="middle">비트코인</text><text x="300" y="258" fill="#94a3b8" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="14" text-anchor="middle">2025-01-13 08:00</text><text x="500" y="258" fill="#fbbf24" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="15" text-anchor="middle">hold</text><text x="700" y="258" fill="#94a3b8" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="15" text-anchor="middle">60%</text><text x="900" y="258" fill="#94a3b8" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="14" text-anchor="middle">160,000,000~165,000,000</text><rect width="1000" height="45" y="275" fill="#065f46"/><text x="100" y="303" fill="#d1fae5" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="15" text-anchor="middle">비트코인</text><text x="300" y="303" fill="#10b981" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle">2025-01-15 20:00</text><text x="500" y="303" fill="#10b981" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="15" font-weight="bold" text-anchor="middle">buy</text><text x="700" y="303" fill="#10b981" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="15" font-weight="bold" text-anchor="middle">78%</text><text x="900" y="303" fill="#10b981" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle">162,000,000~168,000,000</text><text x="1050" y="303" fill="#10b981" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="18">👈 최신</text></g><text x="100" y="470" fill="#10b981" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="20" font-weight="bold">해결책: Window Function (ROW_NUMBER or MAX)</text><rect width="1000" height="260" x="100" y="490" fill="#1e293b" rx="10"/><text x="120" y="520" fill="#fbbf24" font-family="Apple SD Gothic Neo, Courier, monospace" font-size="14" font-weight="bold">-- 방법 1: Subquery로 MAX 사용</text><text x="120" y="545" fill="#cbd5e1" font-family="Apple SD Gothic Neo, Courier, monospace" font-size="13">latest_analysis = (</text><text x="140" y="570" fill="#cbd5e1" font-family="Apple SD Gothic Neo, Courier, monospace" font-size="13">SELECT stock_info_id, MAX(created_at) AS latest_created_at</text><text x="140" y="595" fill="#cbd5e1" font-family="Apple SD Gothic Neo, Courier, monospace" font-size="13">FROM stock_analysis_results</text><text x="140" y="620" fill="#cbd5e1" font-family="Apple SD Gothic Neo, Courier, monospace" font-size="13">GROUP BY stock_info_id</text><text x="120" y="645" fill="#cbd5e1" font-family="Apple SD Gothic Neo, Courier, monospace" font-size="13">)</text><text x="120" y="675" fill="#10b981" font-family="Apple SD Gothic Neo, Courier, monospace" font-size="14" font-weight="bold">-- 방법 2: Window Function 사용</text><text x="120" y="700" fill="#cbd5e1" font-family="Apple SD Gothic Neo, Courier, monospace" font-size="13">ROW_NUMBER() OVER (</text><text x="140" y="725" fill="#cbd5e1" font-family="Apple SD Gothic Neo, Courier, monospace" font-size="13">PARTITION BY stock_info_id ORDER BY created_at DESC</text><text x="120" y="745" fill="#cbd5e1" font-family="Apple SD Gothic Neo, Courier, monospace" font-size="13">) AS rn</text><rect width="1000" height="20" x="100" y="770" fill="#065f46" rx="5"/><text x="600" y="785" fill="#d1fae5" font-family="Apple SD Gothic Neo, Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle">결과: 각 종목당 1개의 최신 분석만 조회 (삼성전자, AAPL, 비트코인 각 1개씩)</text></svg>