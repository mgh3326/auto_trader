<?xml version="1.0" encoding="UTF-8"?>
<svg width="1400" height="1000" xmlns="http://www.w3.org/2000/svg">
    <defs>
        <!-- 화살표 마커 -->
        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#333333" />
        </marker>
    </defs>

    <!-- 배경 -->
    <rect width="1400" height="1000" fill="#ffffff"/>

    <!-- 제목 -->
    <text x="700" y="50" font-family="Arial, sans-serif" font-size="40" font-weight="bold" fill="#1a1a2e" text-anchor="middle">
        JWT 인증 시스템 아키텍처
    </text>

    <!-- 사용자 -->
    <ellipse cx="700" cy="130" rx="80" ry="40" fill="#E0E0E0" stroke="#333333" stroke-width="2"/>
    <text x="700" y="140" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#333333" text-anchor="middle">사용자</text>

    <!-- FastAPI 애플리케이션 영역 -->
    <rect x="50" y="220" width="1300" height="750" fill="#FFF3E0" stroke="#FF9800" stroke-width="3" rx="10"/>
    <text x="700" y="260" font-family="Arial, sans-serif" font-size="28" font-weight="bold" fill="#FF9800" text-anchor="middle">FastAPI 애플리케이션</text>

    <!-- 인증 라우터 -->
    <rect x="100" y="300" width="300" height="200" fill="#4CAF50" stroke="#333333" stroke-width="2" rx="5"/>
    <text x="250" y="340" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#ffffff" text-anchor="middle">인증 라우터</text>
    <text x="250" y="370" font-family="Arial, sans-serif" font-size="18" fill="#ffffff" text-anchor="middle">/auth/register</text>
    <text x="250" y="400" font-family="Arial, sans-serif" font-size="18" fill="#ffffff" text-anchor="middle">/auth/login</text>
    <text x="250" y="430" font-family="Arial, sans-serif" font-size="18" fill="#ffffff" text-anchor="middle">/auth/refresh</text>
    <text x="250" y="460" font-family="Arial, sans-serif" font-size="18" fill="#ffffff" text-anchor="middle">/auth/logout</text>

    <!-- JWT 인증 미들웨어 -->
    <rect x="450" y="300" width="300" height="120" fill="#2196F3" stroke="#333333" stroke-width="2" rx="5"/>
    <text x="600" y="340" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#ffffff" text-anchor="middle">JWT 인증 미들웨어</text>
    <text x="600" y="370" font-family="Arial, sans-serif" font-size="18" fill="#ffffff" text-anchor="middle">토큰 검증</text>
    <text x="600" y="395" font-family="Arial, sans-serif" font-size="18" fill="#ffffff" text-anchor="middle">사용자 인증</text>

    <!-- RBAC (역할 기반 접근 제어) -->
    <rect x="800" y="300" width="280" height="120" fill="#9C27B0" stroke="#333333" stroke-width="2" rx="5"/>
    <text x="940" y="335" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#ffffff" text-anchor="middle">RBAC</text>
    <text x="940" y="360" font-family="Arial, sans-serif" font-size="18" fill="#ffffff" text-anchor="middle">역할 기반</text>
    <text x="940" y="385" font-family="Arial, sans-serif" font-size="18" fill="#ffffff" text-anchor="middle">접근 제어</text>

    <!-- 보호된 API 엔드포인트 -->
    <rect x="450" y="460" width="630" height="150" fill="#FF9800" stroke="#333333" stroke-width="2" rx="5"/>
    <text x="765" y="500" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#ffffff" text-anchor="middle">보호된 API 엔드포인트</text>
    <text x="765" y="535" font-family="Arial, sans-serif" font-size="18" fill="#ffffff" text-anchor="middle">/api/stocks (Viewer+)</text>
    <text x="765" y="565" font-family="Arial, sans-serif" font-size="18" fill="#ffffff" text-anchor="middle">/api/analyze (Analyst+)</text>
    <text x="765" y="595" font-family="Arial, sans-serif" font-size="18" fill="#ffffff" text-anchor="middle">/admin/* (Admin)</text>

    <!-- PostgreSQL -->
    <rect x="100" y="650" width="250" height="100" fill="#336791" stroke="#333333" stroke-width="2" rx="5"/>
    <text x="225" y="690" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#ffffff" text-anchor="middle">PostgreSQL</text>
    <text x="225" y="720" font-family="Arial, sans-serif" font-size="18" fill="#ffffff" text-anchor="middle">사용자 정보</text>

    <!-- Redis -->
    <rect x="400" y="650" width="250" height="100" fill="#DC382D" stroke="#333333" stroke-width="2" rx="5"/>
    <text x="525" y="690" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#ffffff" text-anchor="middle">Redis</text>
    <text x="525" y="720" font-family="Arial, sans-serif" font-size="18" fill="#ffffff" text-anchor="middle">Refresh Token</text>

    <!-- bcrypt -->
    <rect x="700" y="650" width="250" height="100" fill="#F44336" stroke="#333333" stroke-width="2" rx="5"/>
    <text x="825" y="690" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#ffffff" text-anchor="middle">bcrypt</text>
    <text x="825" y="720" font-family="Arial, sans-serif" font-size="18" fill="#ffffff" text-anchor="middle">비밀번호 해싱</text>

    <!-- Rate Limiting -->
    <rect x="1000" y="650" width="280" height="100" fill="#795548" stroke="#333333" stroke-width="2" rx="5"/>
    <text x="1140" y="690" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#ffffff" text-anchor="middle">Rate Limiting</text>
    <text x="1140" y="720" font-family="Arial, sans-serif" font-size="18" fill="#ffffff" text-anchor="middle">무차별 대입 방어</text>

    <!-- 화살표 -->
    <!-- 사용자 → 인증 라우터 -->
    <line x1="700" y1="170" x2="250" y2="300" stroke="#333333" stroke-width="2" marker-end="url(#arrowhead)"/>

    <!-- 인증 라우터 → PostgreSQL -->
    <line x1="250" y1="500" x2="225" y2="650" stroke="#333333" stroke-width="2" marker-end="url(#arrowhead)"/>

    <!-- 인증 라우터 → Redis -->
    <line x1="350" y1="500" x2="500" y2="650" stroke="#333333" stroke-width="2" marker-end="url(#arrowhead)"/>

    <!-- 인증 라우터 → bcrypt -->
    <line x1="400" y1="450" x2="750" y2="650" stroke="#333333" stroke-width="2" marker-end="url(#arrowhead)"/>

    <!-- JWT 미들웨어 → RBAC -->
    <line x1="750" y1="360" x2="800" y2="360" stroke="#333333" stroke-width="2" marker-end="url(#arrowhead)"/>

    <!-- RBAC → 보호된 API -->
    <line x1="940" y1="420" x2="765" y2="460" stroke="#333333" stroke-width="2" marker-end="url(#arrowhead)"/>

    <!-- Rate Limiting -->
    <line x1="400" y1="330" x2="1000" y2="700" stroke="#333333" stroke-width="2" marker-end="url(#arrowhead)" stroke-dasharray="5,5"/>

    <!-- 하단 설명 -->
    <text x="700" y="920" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#FF9800" text-anchor="middle">
        JWT + Redis + bcrypt + RBAC + Rate Limiting
    </text>
    <text x="700" y="955" font-family="Arial, sans-serif" font-size="18" fill="#666666" text-anchor="middle">
        상태 비저장(Stateless) + 강제 로그아웃 + 역할 기반 접근 제어
    </text>
</svg>