<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 700">
  <!-- Background -->
  <rect width="900" height="700" fill="#f8f9fa"/>

  <!-- Title -->
  <text x="450" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#2c3e50">
    모니터링 시스템 아키텍처
  </text>

  <!-- FastAPI App Container -->
  <rect x="50" y="80" width="800" height="350" rx="10" fill="#ffffff" stroke="#3498db" stroke-width="3"/>
  <text x="450" y="110" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#2c3e50">
    FastAPI Application
  </text>

  <!-- MonitoringMiddleware -->
  <rect x="100" y="130" width="700" height="80" rx="8" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
  <text x="450" y="158" text-anchor="middle" font-family="Arial, sans-serif" font-size="15" font-weight="bold" fill="white">
    MonitoringMiddleware
  </text>
  <text x="120" y="180" font-family="Arial, sans-serif" font-size="12" fill="white">
    • HTTP 요청/응답 타이밍 측정
  </text>
  <text x="120" y="198" font-family="Arial, sans-serif" font-size="12" fill="white">
    • 에러 캐치 및 Telegram 리포팅
  </text>

  <text x="480" y="180" font-family="Arial, sans-serif" font-size="12" fill="white">
    • 메트릭 자동 수집
  </text>
  <text x="480" y="198" font-family="Arial, sans-serif" font-size="12" fill="white">
    • OpenTelemetry Span 생성
  </text>

  <!-- Telemetry Manager -->
  <rect x="100" y="240" width="330" height="160" rx="8" fill="#9b59b6" stroke="#8e44ad" stroke-width="2"/>
  <text x="265" y="268" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">
    Telemetry Manager
  </text>
  <text x="120" y="295" font-family="Arial, sans-serif" font-size="11" fill="white">
    📊 Traces (분산 추적)
  </text>
  <text x="130" y="315" font-family="Arial, sans-serif" font-size="10" fill="white">
    - HTTP 요청 흐름 추적
  </text>
  <text x="130" y="330" font-family="Arial, sans-serif" font-size="10" fill="white">
    - DB 쿼리 성능 측정
  </text>
  <text x="130" y="345" font-family="Arial, sans-serif" font-size="10" fill="white">
    - API 호출 체인 분석
  </text>

  <text x="120" y="370" font-family="Arial, sans-serif" font-size="11" fill="white">
    📈 Metrics (메트릭)
  </text>
  <text x="130" y="387" font-family="Arial, sans-serif" font-size="10" fill="white">
    - 응답 시간, 요청 수, 에러율
  </text>

  <!-- ErrorReporter -->
  <rect x="470" y="240" width="330" height="160" rx="8" fill="#e74c3c" stroke="#c0392b" stroke-width="2"/>
  <text x="635" y="268" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">
    Error Reporter
  </text>
  <text x="490" y="295" font-family="Arial, sans-serif" font-size="11" fill="white">
    🚨 실시간 에러 감지
  </text>
  <text x="500" y="315" font-family="Arial, sans-serif" font-size="10" fill="white">
    - ERROR/CRITICAL 레벨 필터링
  </text>
  <text x="500" y="330" font-family="Arial, sans-serif" font-size="10" fill="white">
    - 스택 트레이스 수집
  </text>
  <text x="500" y="345" font-family="Arial, sans-serif" font-size="10" fill="white">
    - 컨텍스트 정보 첨부
  </text>

  <text x="490" y="370" font-family="Arial, sans-serif" font-size="11" fill="white">
    🔁 Redis 중복 제거
  </text>
  <text x="500" y="387" font-family="Arial, sans-serif" font-size="10" fill="white">
    - SHA-256 해시 기반 중복 감지
  </text>

  <!-- Arrow from Telemetry to SigNoz -->
  <path d="M 265 400 L 265 460" stroke="#95a5a6" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <text x="280" y="435" font-family="Arial, sans-serif" font-size="11" fill="#34495e">
    OTLP gRPC
  </text>

  <!-- Arrow from ErrorReporter to Telegram -->
  <path d="M 635 400 L 635 460" stroke="#95a5a6" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <text x="650" y="435" font-family="Arial, sans-serif" font-size="11" fill="#34495e">
    HTTP POST
  </text>

  <!-- SigNoz Box -->
  <rect x="80" y="460" width="370" height="180" rx="10" fill="#27ae60" stroke="#229954" stroke-width="3"/>
  <text x="265" y="490" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white">
    SigNoz (localhost:3301)
  </text>

  <rect x="100" y="510" width="330" height="115" rx="5" fill="#2ecc71" stroke="#27ae60" stroke-width="1"/>
  <text x="115" y="535" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">
    📊 OTLP Collector (포트 4317)
  </text>
  <text x="125" y="555" font-family="Arial, sans-serif" font-size="10" fill="white">
    • Traces/Metrics 수집
  </text>

  <text x="115" y="580" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">
    💾 ClickHouse (데이터 저장소)
  </text>
  <text x="125" y="600" font-family="Arial, sans-serif" font-size="10" fill="white">
    • 7일 데이터 보관 (설정 가능)
  </text>

  <!-- Telegram Box -->
  <rect x="480" y="460" width="350" height="180" rx="10" fill="#3498db" stroke="#2980b9" stroke-width="3"/>
  <text x="655" y="490" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white">
    Telegram Bot API
  </text>

  <rect x="500" y="510" width="310" height="115" rx="5" fill="#5dade2" stroke="#3498db" stroke-width="1"/>
  <text x="515" y="535" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">
    📱 실시간 에러 알림
  </text>
  <text x="525" y="555" font-family="Arial, sans-serif" font-size="10" fill="white">
    [텔레그램 알림 - 03:02]
  </text>
  <text x="525" y="572" font-family="Arial, sans-serif" font-size="10" fill="white">
    ❌ 매수 주문 실패
  </text>
  <text x="525" y="589" font-family="Arial, sans-serif" font-size="10" fill="white">
    코인: 비트코인
  </text>
  <text x="525" y="606" font-family="Arial, sans-serif" font-size="10" fill="white">
    이유: InsufficientFunds
  </text>

  <!-- Bottom note -->
  <text x="450" y="670" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" fill="#7f8c8d" font-style="italic">
    실시간 관찰성: 문제 발생 → 1초 내 감지 → 즉각 대응
  </text>

  <!-- Arrow marker definition -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#95a5a6"/>
    </marker>
  </defs>
</svg>
