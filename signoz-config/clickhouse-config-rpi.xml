<clickhouse>
    <!-- Zookeeper configuration -->
    <zookeeper>
        <node>
            <host>zookeeper</host>
            <port>2181</port>
        </node>
    </zookeeper>

    <!-- Macros for cluster configuration -->
    <macros>
        <cluster>cluster</cluster>
        <shard>01</shard>
        <replica>01</replica>
    </macros>

    <!-- Remote servers configuration for single-node setup -->
    <remote_servers>
        <cluster>
            <shard>
                <replica>
                    <host>clickhouse</host>
                    <port>9000</port>
                </replica>
            </shard>
        </cluster>
    </remote_servers>

    <!-- 설정 검증 스킵 (사용자 레벨 설정을 위해) -->
    <skip_check_for_incorrect_settings>1</skip_check_for_incorrect_settings>

    <!-- Raspberry Pi 메모리 최적화 설정 -->
    <max_memory_usage>1610612736</max_memory_usage> <!-- 1.5GB -->
    <max_bytes_before_external_group_by>1073741824</max_bytes_before_external_group_by> <!-- 1GB -->
    <max_bytes_before_external_sort>1073741824</max_bytes_before_external_sort> <!-- 1GB -->

    <!-- 쿼리 복잡도 제한 -->
    <max_query_size>262144</max_query_size> <!-- 256KB -->
    <max_ast_depth>1000</max_ast_depth>
    <max_ast_elements>50000</max_ast_elements>

    <!-- 백그라운드 작업 제한 -->
    <background_pool_size>16</background_pool_size>
    <background_schedule_pool_size>8</background_schedule_pool_size>
    <background_fetches_pool_size>4</background_fetches_pool_size>
    <background_move_pool_size>4</background_move_pool_size>
    <background_merges_mutations_concurrency_ratio>2</background_merges_mutations_concurrency_ratio>

    <!-- 로그 레벨 낮추기 (I/O 절약) -->
    <logger>
        <level>warning</level>
    </logger>
</clickhouse>
